clc; close all; clear all;

teste1 = [
-0.00  -0.00
-0.00  -0.00
-0.00  0.00
-0.02  0.01
-0.06  0.05
-0.21  0.16
-0.62  0.59
-1.60  1.95
-3.23  4.79
-4.64  7.57
-5.42  8.83
-5.77  9.33
-5.94  9.57
-6.10  9.71
-6.18  9.83
-6.21  9.89
-6.27  9.91
-6.29  9.97
-6.32  10.00
-6.36  10.06
-6.38  10.10
-6.40  10.11
-6.41  10.14
-6.43  10.16
-6.45  10.19
-6.45  10.21
-6.44  10.18
-6.44  10.16
-6.44  10.15
-6.45  10.17
-6.46  10.18
-6.45  10.18
-6.46  10.19
-6.46  10.20
-6.47  10.21
-6.47  10.23
-6.47  10.23
-6.47  10.24
-6.47  10.25
-6.48  10.27
-6.49  10.29
-6.49  10.30
-6.49  10.31
-6.49  10.32
-6.49  10.34
-6.50  10.36
-6.51  10.36
-6.51  10.37
-6.50  10.37
-6.51  10.38
-6.52  10.39
-6.53  10.38
-6.53  10.39
-6.52  10.40
-6.54  10.41
-6.55  10.43
-6.55  10.44
-6.56  10.44
-6.55  10.45
-6.56  10.47
-6.58  10.48
-6.58  10.49
-6.59  10.49
-6.58  10.50
-6.59  10.51
-6.60  10.52
-6.61  10.53
-6.62  10.53
-6.61  10.54
-6.62  10.55
-6.63  10.56
-6.64  10.56
-6.65  10.56
-6.63  10.56
-6.64  10.56
-6.64  10.57
-6.64  10.57
-6.64  10.57
-6.63  10.57
-6.64  10.58
-6.64  10.59
-6.64  10.59
-6.63  10.59
-6.62  10.59
-6.62  10.59
-6.61  10.59
-6.60  10.57
-6.60  10.56
-6.58  10.56
-6.58  10.56
-6.58  10.57
-6.58  10.57
-6.57  10.57
-6.56  10.57
-6.56  10.57
-6.56  10.58
-6.56  10.58
-6.56  10.58
-6.55  10.59
-6.55  10.59];

teste2 = [
0.00  -0.00
0.00  -0.00
0.00  -0.00
0.00  -0.00
0.02  -0.01
0.09  -0.03
0.41  -0.08
1.71  -0.20
5.11  -0.47
8.83  -1.03
10.34  -1.97
11.00  -2.99
11.22  -3.82
11.34  -4.23
11.36  -4.44
11.37  -4.56
11.42  -4.59
11.46  -4.65
11.49  -4.69
11.51  -4.71
11.49  -4.74
11.52  -4.73
11.55  -4.77
11.58  -4.79
11.59  -4.80
11.59  -4.80
11.60  -4.77
11.63  -4.81
11.65  -4.82
11.67  -4.83
11.67  -4.85
11.69  -4.83
11.71  -4.83
11.73  -4.84
11.73  -4.84
11.73  -4.85
11.74  -4.83
11.76  -4.84
11.77  -4.85
11.78  -4.87
11.78  -4.87
11.78  -4.85
11.80  -4.84
11.81  -4.85
11.81  -4.85
11.81  -4.85
11.81  -4.83
11.82  -4.84
11.83  -4.84
11.82  -4.85
11.82  -4.85
11.83  -4.85
11.84  -4.84
11.84  -4.85
11.84  -4.85
11.84  -4.84
11.85  -4.84
11.85  -4.84
11.86  -4.84
11.86  -4.84
11.85  -4.84
11.86  -4.84
11.87  -4.84
11.88  -4.84
11.87  -4.84
11.87  -4.84
11.89  -4.84
11.89  -4.84
11.90  -4.85
11.90  -4.85
11.90  -4.84
11.91  -4.84
11.91  -4.83
11.92  -4.83
11.92  -4.83
11.92  -4.82
11.92  -4.82
11.92  -4.81
11.93  -4.81
11.91  -4.81
11.91  -4.80
11.92  -4.80
11.93  -4.79
11.93  -4.78
11.92  -4.78
11.92  -4.78
11.92  -4.77
11.92  -4.76
11.93  -4.76
11.92  -4.76
11.92  -4.75];

v1 = teste2(8:30,1); %cortando os oito primeiros elementos do experimento

v2 = teste1(8:30,2); %cortando os oito primeiros elementos do experimento
dt = 0.1;

t = 0:dt:(length(v1)-1)*dt;



%ganho: máximo das curvas dividido pelo sinal de excitação (no caso 1000)
% a1 = max(v1)/1000;
% a2 = max(v2)/1000;

%ganho 2.0: média dos valores do estado estacionário da resposta ao degrau.

a1 = mean(v1(8:end))/1000;
a2 = mean(v2(8:end))/1000;


%constante de tempo: tempo necessário para chegar a 63% da maxima amplitude
valor_v1= max(v1)*0.63;%achando 63% do valor maximo
aux_v1 = abs(v1 - valor_v1); 

[~, idx_v1] = min(aux_v1);

b1 = t(idx_v1);


valor_v2= max(v2)*0.63;%achando 63% do valor maximo
aux_v2 = abs(v2 - valor_v2); 

[~, idx_v2] = min(aux_v2);

b2 = t(idx_v2);


%criando as funcoes de transferencias
Gv1 = tf([a1],[b1 1]);
%s = tf('s');
%Gv1 = a1*exp(-0.5*s)/(b1*s+1);
Gv2 = tf([a2],[b2 1]);
%Gv2 = a2*exp(-0.5*s)/(b2*s+1);
% aplicando e degrau nos sistemas estimados
v1_estimado = lsim(Gv1,1000*ones(length(t),1),t);
v2_estimado = lsim(Gv2,1000*ones(length(t),1),t);



%mexendo no mundo discreto
Gz1 = c2d(Gv1,dt,'tustin');
Gz2 = c2d(Gv2,dt,'tustin');

v1_estimado_z = lsim(Gz1,1000*ones(length(t),1),t);
v2_estimado_z = lsim(Gz2,1000*ones(length(t),1),t);

%plotando as respostas
plot(t,v1)
hold on
plot(t,v1_estimado,'r--')
plot(t,v1_estimado_z,'k*')
xlabel('Tempo (s)');
ylabel('Velocidade (Hz)');
figure

plot(t,v2)
hold on
plot(t,v2_estimado,'r--')
plot(t,v2_estimado_z,'k*')
xlabel('Tempo (s)');
ylabel('Velocidade (Hz)');
